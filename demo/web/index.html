<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>FlexImg demo</title>

    <!-- ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <script>
        // CSSã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ä»˜ãã§èª­ã¿è¾¼ã¿
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = 'style.css?t=' + Date.now();
        document.head.appendChild(link);
    </script>
</head>
<body>
    <!-- å·¦è¢–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-content">
            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
            <div class="sidebar-accordion-item active" data-accordion="content">
                <button class="sidebar-accordion-header">
                    <span class="sidebar-accordion-icon">â–¼</span>
                    <span>ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</span>
                </button>
                <div class="sidebar-accordion-content">
                    <div class="content-library-actions">
                        <button id="sidebar-add-image-btn" class="primary-btn sidebar-add-btn">ğŸ“ ç”»åƒã‚’è¿½åŠ </button>
                        <button id="sidebar-add-output-btn" class="primary-btn sidebar-add-btn">ğŸ“¤ å‡ºåŠ›ã‚’è¿½åŠ </button>
                    </div>
                    <div id="sidebar-images-library" class="sidebar-images-library"></div>
                </div>
            </div>

            <!-- ãƒ‘ãƒ¬ãƒƒãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
            <div class="sidebar-accordion-item" data-accordion="palette">
                <button class="sidebar-accordion-header">
                    <span class="sidebar-accordion-icon">â–¶</span>
                    <span>ğŸ¨ ãƒ‘ãƒ¬ãƒƒãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª</span>
                </button>
                <div class="sidebar-accordion-content">
                    <div class="palette-library-actions">
                        <select id="palette-preset-select" class="sidebar-select">
                            <option value="">ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’è¿½åŠ ...</option>
                        </select>
                    </div>
                    <div id="sidebar-palette-library" class="sidebar-palette-library"></div>
                </div>
            </div>

            <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
            <div class="sidebar-accordion-item" data-accordion="debug">
                <button class="sidebar-accordion-header">
                    <span class="sidebar-accordion-icon">â–¶</span>
                    <span>ğŸ› ãƒ‡ãƒãƒƒã‚°</span>
                </button>
                <div class="sidebar-accordion-content">
                    <!-- ãƒ‡ãƒãƒƒã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯JSå´ã§å‹•çš„ç”Ÿæˆ -->
                    <div class="debug-details" id="debug-details"></div>
                </div>
            </div>
        </div>
    </aside>

    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰ -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ -->
    <button id="sidebar-toggle" class="sidebar-toggle" title="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
        <span class="sidebar-toggle-icon">â˜°</span>
    </button>

    <div class="container">
        <header>
            <h1>ğŸ–¼ï¸ FlexImg demo</h1>
            <p>è¤‡æ•°ç”»åƒã®ã‚¢ãƒ•ã‚£ãƒ³å¤‰æ›ãƒ»åˆæˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</p>
            <div id="version-info" class="version-info"></div>
        </header>

        <!-- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ¼ãƒ‰ã‚°ãƒ©ãƒ• -->
        <div class="node-graph-section">
            <div class="node-graph-header">
                <h2>ğŸ”— ãƒãƒ¼ãƒ‰ã‚°ãƒ©ãƒ•</h2>
                <div class="node-graph-controls">
                    <button id="copy-state-url-btn" class="secondary-btn small" title="ç¾åœ¨ã®çŠ¶æ…‹ã‚’URLã¨ã—ã¦ã‚³ãƒ”ãƒ¼">ğŸ”— URLã‚³ãƒ”ãƒ¼</button>
                    <button id="reset-state-btn" class="secondary-btn small danger" title="ä¿å­˜ã•ã‚ŒãŸçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãƒªã‚»ãƒƒãƒˆ">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                    <div class="node-add-dropdown" id="node-add-dropdown">
                        <button class="node-add-btn" id="node-add-btn">+ ãƒãƒ¼ãƒ‰è¿½åŠ </button>
                        <div class="node-add-menu" id="node-add-menu">
                            <!-- app.jsã®populateNodeAddMenu()ã§å‹•çš„ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="node-graph-canvas-container">
                <svg id="node-graph-canvas" width="1600" height="1200" viewBox="0 0 1600 1200">
                    <!-- ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ï¼ˆç”»åƒã€ãƒ•ã‚£ãƒ«ã‚¿ã€åˆæˆã€å‡ºåŠ›ï¼‰ãŒã“ã“ã«æç”»ã•ã‚Œã‚‹ -->
                </svg>
                <div class="node-graph-help">
                    ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ãƒãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—ï¼†ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹• | ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´
                </div>
            </div>
        </div>

        <!-- ã‚¹ãƒ—ãƒªãƒƒã‚¿ãƒ¼ãƒãƒ¼ -->
        <div id="splitter" class="splitter">
            <div class="splitter-handle"></div>
        </div>

        <div class="main-content">
            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="preview-section">
                <div class="canvas-container">
                    <canvas id="preview-canvas"></canvas>
                </div>
                <div class="canvas-controls">
                    <div class="preview-scale-control">
                        <span class="scale-label">å€ç‡</span>
                        <input type="range" id="sidebar-preview-scale" min="1" max="5" step="0.1" value="1" class="scale-slider">
                        <span id="sidebar-preview-scale-value" class="scale-value">1x</span>
                    </div>
                    <button id="download-btn" class="primary-btn">ğŸ“¥ ç”»åƒã‚’ä¿å­˜</button>
                </div>
            </div>
        </div>

        <!-- éš ã—ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ› -->
        <input type="file" id="image-input" accept="image/*" style="display:none;" multiple>
    </div>

    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¤ãƒ†ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆç”»åƒãƒ»å‡ºåŠ›å…±é€šï¼‰ -->
    <template id="content-item-template">
        <div class="content-item">
            <div class="content-thumbnail">
                <img src="" alt="thumbnail">
            </div>
            <div class="content-info">
                <span class="content-name">Content</span>
                <div class="content-row">
                    <span class="content-size">0x0</span>
                    <div class="content-actions">
                        <button class="add-node-btn" title="ãƒãƒ¼ãƒ‰è¿½åŠ ">+ ãƒãƒ¼ãƒ‰</button>
                        <button class="delete-btn" title="å‰Šé™¤">Ã—</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- ãƒãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div id="node-context-menu" class="context-menu" style="display: none;">
        <div class="context-menu-item" id="detail-node-menu">âš™ï¸ è©³ç´°</div>
        <div class="context-menu-item" id="add-input-menu" style="display: none;">â• å…¥åŠ›ã‚’è¿½åŠ </div>
        <div class="context-menu-item" id="add-output-menu" style="display: none;">â• å‡ºåŠ›ã‚’è¿½åŠ </div>
        <div class="context-menu-item" id="delete-node-menu">ğŸ—‘ï¸ ãƒãƒ¼ãƒ‰ã‚’å‰Šé™¤</div>
    </div>

    <!-- ãƒãƒ¼ãƒ‰è©³ç´°ãƒ‘ãƒãƒ« -->
    <div id="node-detail-panel" class="node-detail-panel" style="display: none;">
        <div class="node-detail-header">
            <span class="node-detail-title">ãƒãƒ¼ãƒ‰è©³ç´°</span>
            <button class="node-detail-close">Ã—</button>
        </div>
        <div class="node-detail-content"></div>
    </div>

    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>WebAssemblyèª­ã¿è¾¼ã¿ä¸­...</p>
    </div>

    <!-- ãƒ‡ãƒãƒƒã‚°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
    <div id="debug-status-bar" class="debug-status-bar">
        <span class="debug-status-label">â±ï¸ Perf:</span>
        <span id="debug-perf-total" class="debug-status-item">--</span>
        <span class="debug-status-sep">|</span>
        <span id="debug-perf-details" class="debug-status-details">--</span>
    </div>

    <!-- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ä»˜ãã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script>
        // version.jsã‚’åŒæœŸçš„ã«èª­ã¿è¾¼ã‚€
        const versionScript = document.createElement('script');
        versionScript.src = 'version.js?t=' + Date.now();
        document.head.appendChild(versionScript);

        versionScript.onload = function() {
            // ãƒ“ãƒ«ãƒ‰æƒ…å ±ã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ï¼ˆgitCommit or buildDateï¼‰
            const version = (typeof BUILD_INFO !== 'undefined')
                ? BUILD_INFO.gitCommit
                : Date.now();

            console.log('Loading scripts with cache buster:', version);

            // WebAssemblyãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿
            const wasmScript = document.createElement('script');
            wasmScript.src = 'fleximg.js?v=' + version;
            document.head.appendChild(wasmScript);

            // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’èª­ã¿è¾¼ã¿ï¼ˆWASMã®å¾Œã«ï¼‰
            wasmScript.onload = function() {
                const appScript = document.createElement('script');
                appScript.type = 'module';
                appScript.src = 'app.js?v=' + version;
                document.head.appendChild(appScript);
            };
        };
    </script>
</body>
</html>
