; fleximg Examples - Unified PlatformIO Configuration
;
; Usage:
;   Benchmark:
;     pio run -e bench_native && .pio/build/bench_native/program
;     pio run -e bench_m5stack_core2 -t upload
;
;   Basic Demo:
;     pio run -e basic_native && .pio/build/basic_native/program
;     pio run -e basic_m5stack_core2 -t upload
;
;   Matte Demo:
;     pio run -e matte_native && .pio/build/matte_native/program
;     pio run -e matte_m5stack_core2 -t upload
;
; Serial monitor: pio device monitor -b 115200

[platformio]
default_envs = bench_native
src_dir = examples
include_dir = src

; =============================================================================
; Common Settings
; =============================================================================
[common]
; 共通の基本設定
build_flags =
    -std=c++17
    -DFLEXIMG_NAMESPACE=fleximg
;    -DFLEXIMG_TRAP_DEFAULT_ALLOCATOR
;    -DFLEXIMG_DEBUG

[common_m5stack]
; ESP32: 基本的な警告のみ（フレームワーク警告を抑制）
platform = espressif32
framework = arduino
build_type = release
lib_deps = m5stack/M5Unified@^0.2.13
monitor_speed = 115200
monitor_filters = esp32_exception_decoder
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio
build_unflags =
    -Os
    -std=gnu++11
    -DBOARD_HAS_PSRAM  ; PSRAM使用時に定義されるマクロを無効化
build_flags =
    ${common.build_flags}
    -std=gnu++17
    -Wall
    -DBOARD_HAS_PSRAM=0
    -O2

[common_native]
; native: 厳しい警告オプションを有効化（CI対応）
platform = native
build_flags =
    ${common.build_flags}
    -Wall
    -Wextra
    -Wpedantic
    -Wconversion
    -Wsign-conversion
    -Wshadow
    -Wcast-qual
    -Wdouble-promotion
    -Wformat=2
    -Wnull-dereference
    -Wunused
    -O0 -xc++ -std=c++17
    -I./src

[common_native_sdl2]
; native + SDL2（macOSローカル環境用）
extends = common_native
build_flags =
    ${common_native.build_flags}
    -lSDL2 -arch arm64
    -I"/usr/local/include/SDL2"
    -L"/usr/local/lib"
    -I"${sysenv.HOMEBREW_PREFIX}/include/SDL2"
    -L"${sysenv.HOMEBREW_PREFIX}/lib"

[common_native_m5]
; native環境でM5Unified使用時の共通設定
extends = common_native_sdl2
lib_deps = m5stack/M5Unified

; =============================================================================
; Benchmark Environments
; =============================================================================
[env:bench_native]
extends = common_native
build_src_filter = +<bench/src/*>
build_flags =
    ${common_native.build_flags}
    -DBENCH_NATIVE=1

[env:bench_m5stack_core2]
extends = common_m5stack
board = m5stack-core2
build_src_filter = +<bench/src/*>
build_flags =
    ${common_m5stack.build_flags}
    -DBENCH_M5STACK=1

[env:bench_m5stack_cores3]
extends = common_m5stack
board = m5stack-cores3
build_src_filter = +<bench/src/*>
build_flags =
    ${common_m5stack.build_flags}
    -DBENCH_M5STACK=1

; =============================================================================
; Basic Demo Environments
; =============================================================================
[env:basic_native]
extends = common_native_m5
build_src_filter = +<m5stack_basic/src/*>

[env:basic_m5stack_core2]
extends = common_m5stack
board = m5stack-core2
build_src_filter = +<m5stack_basic/src/*>
build_flags =
    ${common_m5stack.build_flags}
    -DARDUINO_M5STACK_CORE2

[env:basic_m5stack_cores3]
extends = common_m5stack
board = m5stack-cores3
build_src_filter = +<m5stack_basic/src/*>
build_flags =
    ${common_m5stack.build_flags}
    -DARDUINO_M5STACK_CORES3

; =============================================================================
; Matte Demo Environments
; =============================================================================
[env:matte_native]
extends = common_native_m5
build_src_filter = +<m5stack_matte/src/*>

[env:matte_m5stack_core2]
extends = common_m5stack
board = m5stack-core2
build_src_filter = +<m5stack_matte/src/*>
build_flags =
    ${common_m5stack.build_flags}
    -DARDUINO_M5STACK_CORE2

[env:matte_m5stack_cores3]
extends = common_m5stack
board = m5stack-cores3
build_src_filter = +<m5stack_matte/src/*>
build_flags =
    ${common_m5stack.build_flags}
    -DARDUINO_M5STACK_CORES3

; =============================================================================
; HOS Demo Environments (Patlabor-style animation)
; =============================================================================
[env:hos_native]
extends = common_native_m5
build_src_filter = +<m5stack_hos/src/*>

[env:hos_m5stack_core2]
extends = common_m5stack
board = m5stack-core2
build_src_filter = +<m5stack_hos/src/*>
build_flags =
    ${common_m5stack.build_flags}
    -DARDUINO_M5STACK_CORE2

[env:hos_m5stack_cores3]
extends = common_m5stack
board = m5stack-cores3
build_src_filter = +<m5stack_hos/src/*>
build_flags =
    ${common_m5stack.build_flags}
    -DARDUINO_M5STACK_CORES3

; =============================================================================
; VerticalBlurNode Coordinate Test
; =============================================================================
[env:vblur_test_native]
extends = common_native
build_src_filter = +<vblur_test/src/*>
